---
- name: Create token for FlashArray
  hosts: localhost
  gather_facts: no
  vars:
    arrayurl: chas-pure1.hy-vee.net
    api_version: "1.15"
    username: Ansible_Systems_Svc
    password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          35623637333231326266363238336336366430393934643037306139313130626563373632303830
          3234373831333461636163346237316461363431623039640a343232313565346639306138343333
          61333736353438663436646262663932303637316335373938326663333763326633643232383364
          3864363464353538660a616165383664643636653130306665373163353336333365323436653261
          3034

  tasks:
    - name: open session
      uri:
        url: https://{{ arrayurl }}/api/{{ api_version }}/auth/apitoken
        method: POST
        validate_certs: no
        return_content: yes
        body:
          username: "{{ username }}"
          password: "{{password }}"
        body_format: json
      register: token

    - name: display token
      debug: msg="{{ token.json }}"
